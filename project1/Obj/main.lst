C51 COMPILER V9.01   MAIN                                                                  12/19/2025 17:22:58 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Obj\main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE User\main.c BROWSE INCDIR(.\Public;.\App\IRED;.\App\smg;.\App\BEEP;.\App\LE
                    -D;.\App\lcd1602;.\App\rectanglekey;.\App\ds1302) DEBUG OBJECTEXTEND PRINT(.\Obj\main.lst) OBJECT(.\Obj\main.obj)

line level    source

   1          #include "smg.h"
   2          #include "lcd1602.h"
   3          #include "ds1302.h"
   4          #include "public.h"
   5          #include <stdio.h>  // 用于 sprintf
   6          
   7          // BCD 转十进制宏
   8          #define BCD2DEC(bcd) (((bcd) >> 4) * 10 + ((bcd) & 0x0F))
   9          
  10          void main()
  11          {
  12   1          u8 ired_buf[3];
  13   1          u8 key = 0;
  14   1          u8 time_buf[8];
  15   1          u8 lcd_str[9]; // 用于构造显示字符串
  16   1      
  17   1          ds1302_init();      // 初始化DS1302
  18   1          lcd1602_init();     // LCD1602初始化
  19   1      
  20   1          // 可选：首次清屏或设置标题
  21   1          lcd1602_show_string(1, 0, "Date:2025-12-19"); // 预留空间
  22   1      //    lcd1602_show_string(2, , "Time:        ");
  23   1      
  24   1          while(1)
  25   1          {
  26   2              ds1302_read_time();
  27   2      
  28   2              // === 数码管显示（保持不变）===
  29   2              time_buf[0] = gsmg_code[gDS1302_TIME[2] / 16];
  30   2              time_buf[1] = gsmg_code[gDS1302_TIME[2] & 0x0f];
  31   2              time_buf[2] = 0x40; // '-'
  32   2              time_buf[3] = gsmg_code[gDS1302_TIME[1] / 16];
  33   2              time_buf[4] = gsmg_code[gDS1302_TIME[1] & 0x0f];
  34   2              time_buf[5] = 0x40;
  35   2              time_buf[6] = gsmg_code[gDS1302_TIME[0] / 16];
  36   2              time_buf[7] = gsmg_code[gDS1302_TIME[0] & 0x0f];
  37   2              smg_display(time_buf, 1);
  38   2      
  39   2              // === LCD1602 显示日期和时间 ===
  40   2              // 第一行：年-月-日 （假设 gDS1302_TIME[6]=年, [4]=月, [3]=日）
  41   2      //        sprintf((char*)lcd_str, "20%02d-%02d-%02d",
  42   2      //                BCD2DEC(gDS1302_TIME[6]),
  43   2      //                BCD2DEC(gDS1302_TIME[4]),
  44   2      //                BCD2DEC(gDS1302_TIME[3]));
  45   2      //        lcd1602_show_string(1, 1, lcd_str);
  46   2      
  47   2              // 第二行：时:分:秒
  48   2      //        sprintf((char*)lcd_str, "%02d:%02d:%02d",
  49   2      //                BCD2DEC(gDS1302_TIME[2]/ 16,gDS1302_TIME[2] & 0x0f),
  50   2      //                BCD2DEC(gDS1302_TIME[1]),
  51   2      //                BCD2DEC(gDS1302_TIME[0]));
  52   2      //        lcd1602_show_string(2, 0, lcd_str);
  53   2      
  54   2      //        // 延时避免频繁刷新（可选，LCD 刷新快，但减少 CPU 占用）
C51 COMPILER V9.01   MAIN                                                                  12/19/2025 17:22:58 PAGE 2   

  55   2      //        delay_ms(200); // 假设 public.h 中有 delay_ms，否则自己实现
  56   2          }
  57   1      }
*** WARNING C280 IN LINE 12 OF USER\MAIN.C: 'ired_buf': unreferenced local variable
*** WARNING C280 IN LINE 15 OF USER\MAIN.C: 'lcd_str': unreferenced local variable


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    107    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      21
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
